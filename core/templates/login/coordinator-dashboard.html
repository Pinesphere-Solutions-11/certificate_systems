{% load static %}
<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
    <meta http-equiv="Pragma" content="no-cache" />
    <meta http-equiv="Expires" content="0" />
    <title>Pinesphere | Coordinator Dashboard</title>
    <link rel="icon" type="image/png" href="https://i.ibb.co/r2xvtYsR/logo-removebg-preview.png">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap"
        rel="stylesheet">

    <style>
        :root {
            --sidebar-width: 275px;
            --primary-color: #3b82f6;
            --primary-dark: #1d4ed8;
            --primary-light: #dbeafe;
            --secondary-color: #8b5cf6;
            --accent-color: #06b6d4;
            --success-color: #10b981;
            --warning-color: #f59e0b;
            --danger-color: #ef4444;
            --info-color: #06b6d4;

            /* Dark theme colors */
            --sidebar-bg: linear-gradient(180deg, #0f172a 0%, #020617 100%);
            --sidebar-text: #e2e8f0;
            --sidebar-active: rgba(59, 130, 246, 0.15);
            --sidebar-hover: rgba(255, 255, 255, 0.05);

            /* Content colors */
            --content-bg: #f8fafc;
            --card-bg: #ffffff;
            --text-dark: #0f172a;
            --text-light: #64748b;
            --text-muted: #838588;
            --border-color: #e2e8f0;
            --border-hover: #cbd5e1;

            /* Shadows */
            --shadow-sm: 0 1px 2px rgba(0, 0, 0, 0.05);
            --shadow-md: 0 4px 6px rgba(0, 0, 0, 0.07);
            --shadow-lg: 0 10px 15px rgba(0, 0, 0, 0.1);
            --shadow-xl: 0 20px 25px rgba(0, 0, 0, 0.1);

            /* Animations */
            --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            --transition-fast: all 0.15s ease;
            --border-radius: 16px;
            --border-radius-sm: 8px;
            --border-radius-lg: 24px;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background: var(--sidebar-bg);
            color: var(--content-bg);
            line-height: 1.6;
            display: flex;
            min-height: 100vh;
        }

        /* Sidebar */
        .sidebar {
            width: var(--sidebar-width);
            background: var(--sidebar-bg);
            color: var(--sidebar-text);
            position: fixed;
            height: 100vh;
            left: 0;
            top: 0;
            z-index: 1000;
            overflow-y: auto;
            box-shadow: var(--shadow-xl);
        }

        .sidebar-header {
            padding: 2rem 1.5rem;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .logo-container {
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .logo-icon {
            width: 48px;
            height: 48px;
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            border-radius: var(--border-radius-sm);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            color: white;
        }

        .logo-text h2 {
            font-size: 1.25rem;
            font-weight: 700;
            margin-bottom: 0.25rem;
        }

        .logo-text p {
            font-size: 0.75rem;
            color: var(--text-muted);
            font-weight: 400;
        }

        .sidebar-nav {
            padding: 1.5rem 0;
        }

        .nav-section {
            margin-bottom: 2rem;
        }

        .nav-section-title {
            font-size: 0.75rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            color: var(--text-muted);
            margin-bottom: 0.75rem;
            padding: 0 1.5rem;
        }

        .nav-item {
            display: flex;
            align-items: center;
            padding: 0.75rem 1.5rem;
            color: var(--sidebar-text);
            text-decoration: none;
            transition: var(--transition);
            border-left: 3px solid transparent;
            margin-bottom: 0.25rem;
        }

        .nav-item:hover {
            background: var(--sidebar-hover);
            border-left-color: var(--primary-color);
        }

        .nav-item.active {
            background: var(--sidebar-active);
            border-left-color: var(--primary-color);
            color: var(--primary-color);
        }

        .nav-item i {
            width: 20px;
            height: 20px;
            margin-right: 0.75rem;
            font-size: 1.1rem;
        }

        /* Main Content */
        .main-content {
            margin-left: var(--sidebar-width);
            flex: 1;
            min-height: 100vh;
        }

        .top-bar {
            background: var(--card-bg);
            padding: 1rem 2rem;
            box-shadow: var(--shadow-sm);
            border-bottom: 1px solid var(--border-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .page-title h1 {
            font-size: 1.75rem;
            font-weight: 700;
            color: var(--text-dark);
            margin-bottom: 0.25rem;
        }

        .page-title p {
            color: var(--text-light);
            font-size: 0.875rem;
        }

        .logout-btn {
            background: linear-gradient(135deg, var(--danger-color), #dc2626);
            color: white;
            border: none;
            padding: 0.75rem 1.5rem;
            border-radius: var(--border-radius-sm);
            font-weight: 600;
            font-size: 0.875rem;
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            gap: 0.5rem;
            box-shadow: var(--shadow-sm);
        }

        .logout-btn:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
            background-color: #a71d1d;
        }

        .dashboard-container {
            padding: 2rem;
        }

        /* Action Buttons */
        .action-buttons {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 1rem;
            margin-bottom: 2rem;
        }

        .action-card {
            background: var(--card-bg);
            border-radius: var(--border-radius);
            padding: 1.5rem;
            border: 1px solid var(--border-color);
            transition: var(--transition);
            cursor: pointer;
            box-shadow: var(--shadow-sm);
        }

        .action-card:hover {
            transform: translateY(-4px);
            box-shadow: var(--shadow-lg);
            border-color: var(--primary-color);
        }

        .action-card-icon {
            width: 48px;
            height: 48px;
            border-radius: var(--border-radius-sm);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.25rem;
            color: white;
            margin-bottom: 1rem;
        }

        .action-card:nth-child(1) .action-card-icon {
            background: linear-gradient(135deg, var(--primary-color), var(--primary-dark));
        }

        .action-card:nth-child(2) .action-card-icon {
            background: linear-gradient(135deg, var(--success-color), #059669);
        }

        .action-card:nth-child(3) .action-card-icon {
            background: linear-gradient(135deg, var(--warning-color), #d97706);
        }

        .action-card h3 {
            font-size: 1.1rem;
            font-weight: 600;
            color: var(--text-dark);
            margin-bottom: 0.5rem;
        }

        .action-card p {
            color: var(--text-light);
            font-size: 0.875rem;
            line-height: 1.5;
        }

        /* Forms */
        .certificate-form {
            display: none;
            margin-bottom: 2rem;
        }

        .form-card {
            background: var(--sidebar-bg);
            border-radius: var(--border-radius);
            padding: 2rem;
            box-shadow: var(--shadow-md);
            border: 1px solid var(--text-muted);
        }

        .form-card:hover {
            border: 1px solid var(--primary-color);
        }

        .form-card h3 {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--content-bg);
            margin-bottom: 1.5rem;
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .form-card h3 i {
            width: 32px;
            height: 32px;
            background: linear-gradient(135deg, var(--primary-color), var(--primary-dark));
            border-radius: var(--border-radius-sm);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 0.875rem;
        }

        .form-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1.5rem;
            margin-bottom: 1.5rem;
        }

        .form-group {
            margin-bottom: 0;
        }

        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 600;
            color: var(--content-bg);
            font-size: 0.875rem;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 0.875rem 1rem;
            border: 2px solid var(--sidebar-bg);
            border-radius: var(--border-radius-sm);
            font-family: inherit;
            font-size: 0.875rem;
            transition: var(--transition);
            color: var(--content-bg);
            background: var(--sidebar-bg);
        }


        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            color: var(--sidebar-bg);
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }

        .form-actions {
            margin-top: 2rem;
            text-align: right;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--primary-color), var(--primary-dark));
            color: white;
            border: none;
            padding: 0.875rem 2rem;
            border-radius: var(--border-radius-sm);
            font-weight: 600;
            font-size: 0.875rem;
            cursor: pointer;
            transition: var(--transition);
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            box-shadow: var(--shadow-sm);
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
        }

    

        /* Data Table */
        .data-section {
            background: var(--sidebar-bg);
            border-radius: var(--border-radius);
            box-shadow: var(--shadow-md);
            border: 1px solid var(--border-hover);
            overflow: hidden;
        }

        .data-section:hover {
            border: 1px solid var(--primary-color);
        }

        .section-header {
            padding: 1rem;
            border-bottom: 1px solid var(--border-color);
            background: linear-gradient(135deg, var(--sidebar-bg));
        }

        .section-title {
            font-size: 1.25rem;
            font-weight: 700;
            color: var(--content-bg);
            display: flex;
            align-items: center;
            gap: 0.75rem;
            margin: 0;
        }

        .section-title i {
            width: 32px;
            height: 32px;
            background: linear-gradient(135deg, var(--primary-color), var(--primary-dark));
            border-radius: var(--border-radius-sm);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 0.875rem;
        }

        .data-table {
            width: 100%;
            border-collapse: collapse;
        }

        .data-table th {
            text-align: left;
            padding: 1rem 1.5rem;
            background: var(--text-dark);
            font-weight: 600;
            color: #f8fafc;
            font-size: 0.875rem;
            text-transform: uppercase;
            letter-spacing: 0.025em;
            border-bottom: 1px solid var(--border-color);
        }

        .data-table td {
            padding: 1rem 1.5rem;
            border-bottom: 1px solid var(--border-color);
            font-size: 0.875rem;
        }

        .empty-state {
            text-align: center;
            padding: 3rem 2rem;
            color: var(--text-light);
        }

        .empty-state i {
            font-size: 3rem;
            color: var(--text-muted);
            margin-bottom: 1rem;
        }

        /* Pagination */
        .pagination {
            display: flex;
            justify-content: center;
            align-items: center;
            flex-wrap: wrap;
            gap: 0.5rem;
            margin-top: 2rem;
            padding: 1rem;
        }

        .pagination a,
        .pagination span {
            padding: 0.75rem 1rem;
            border-radius: var(--border-radius-sm);
            background: var(--card-bg);
            color: var(--text-dark);
            text-decoration: none;
            font-weight: 500;
            border: 1px solid var(--border-color);
            transition: var(--transition);
            box-shadow: var(--shadow-sm);
            font-size: 0.875rem;
        }

        .pagination a:hover {
            background: var(--primary-color);
            color: white;
            border-color: var(--primary-color);
            transform: translateY(-1px);
        }

        .pagination .current {
            background: var(--primary-color);
            color: white;
            border-color: var(--primary-color);
            font-weight: 600;
        }

        /* Footer */
        .dashboard-footer {
            background: var(--card-bg);
            margin-top: 3rem;
            padding: 3rem 2rem 2rem;
            border-top: 1px solid var(--border-color);
        }

        .footer-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 2rem;
            margin-bottom: 2rem;
        }

        .footer-section h3 {
            color: var(--text-dark);
            font-weight: 600;
            margin-bottom: 1rem;
        }

        .footer-section ul {
            list-style: none;
        }

        .footer-section li {
            margin-bottom: 0.5rem;
        }

        .footer-section a {
            color: var(--text-light);
            text-decoration: none;
            transition: var(--transition);
        }

        .footer-section a:hover {
            color: var(--primary-color);
        }

        .copyright {
            text-align: center;
            padding-top: 2rem;
            border-top: 1px solid var(--border-color);
            color: var(--text-light);
            font-size: 0.875rem;
        }

        /* Error message styling */
        .error-message {
            color: var(--danger-color);
            font-size: 0.75rem;
            margin-top: 0.25rem;
        }

        .signature-preview {
            max-width: 200px;
            max-height: 100px;
            margin-top: 0.5rem;
            display: none;
            border-radius: var(--border-radius-sm);
        }

        /* Responsive */
        @media (max-width: 1024px) {
            .sidebar {
                transform: translateX(-100%);
                transition: transform 0.3s ease;
            }

            .sidebar.open {
                transform: translateX(0);
            }

            .main-content {
                margin-left: 0;
            }

            .mobile-menu-btn {
                display: block;
            }
        }

        @media (max-width: 768px) {
            .dashboard-container {
                padding: 1rem;
            }

            .top-bar {
                padding: 1rem;
                flex-direction: column;
                gap: 1rem;
                align-items: flex-start;
            }

            .action-buttons {
                grid-template-columns: 1fr;
            }

            .form-row {
                grid-template-columns: 1fr;
                gap: 1rem;
            }

            .data-table {
                font-size: 0.75rem;
            }

            .data-table th,
            .data-table td {
                padding: 0.75rem 0.5rem;
            }
        }

        .mobile-menu-btn {
            display: none;
            background: var(--primary-color);
            color: white;
            border: none;
            padding: 0.75rem;
            border-radius: var(--border-radius-sm);
            cursor: pointer;
        }

        /* Popup notification */
        #popupNotification {
            position: fixed;
            top: 20px;
            right: 20px;
            background-color: var(--success-color);
            color: white;
            padding: 1rem 1.5rem;
            border-radius: var(--border-radius-sm);
            font-weight: 600;
            z-index: 9999;
            display: none;
            box-shadow: var(--shadow-lg);
            transition: var(--transition);
        }

        .download-btn {
            background: linear-gradient(135deg, var(--success-color), #059669);
            color: white;
            padding: 0.5rem 1rem;
            border-radius: var(--border-radius-sm);
            text-decoration: none;
            font-size: 0.75rem;
            font-weight: 600;
            transition: var(--transition);
            display: inline-flex;
            align-items: center;
            gap: 0.25rem;
        }

        .download-btn:hover {
            transform: translateY(-1px);
            box-shadow: var(--shadow-sm);
        }

        .disabled {
            background: var(--text-muted);
            cursor: not-allowed;
        }

        /* Buttons */
        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            padding: 0.875rem 1.75rem;
            border-radius: var(--border-radius-sm);
            font-weight: 600;
            transition: var(--transition);
            cursor: pointer;
            border: none;
            font-size: 0.875rem;
            text-decoration: none;
            position: relative;
            overflow: hidden;
        }

        .btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transition: left 0.5s;
        }

        .btn:hover::before {
            left: 100%;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
        }

        .btn-success {
            background: linear-gradient(135deg, var(--success-color), #059669);
            color: white;
        }

        .btn-warning {
            background: linear-gradient(135deg, var(--warning-color), #d97706);
            color: white;
        }

        .btn-danger {
            background: linear-gradient(135deg, var(--danger-color), #dc2626);
            color: white;
        }

        .btn-info {
            background: linear-gradient(135deg, var(--info-color), #0891b2);
            color: white;
        }

        .btn-outline {
            background: transparent;
            border: 2px solid var(--border-color);
            color: var(--text-dark);
        }

        .btn-outline:hover {
            background: var(--primary-color);
            color: white;
            border-color: var(--primary-color);
        }

        .btn-sm {
            padding: 0.525rem;
            font-size: 0.75rem;
        }

        /* Status Badges */
        .status-badge {
            display: inline-flex;
            align-items: center;
            padding: 0.5rem 1rem;
            border-radius: var(--border-radius-lg);
            font-size: 0.75rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .status-active {
            background: linear-gradient(135deg, rgba(16, 185, 129, 0.1), rgba(5, 150, 105, 0.1));
            color: var(--success-color);
            border: 1px solid rgba(16, 185, 129, 0.2);
        }

        .status-active {
            background: linear-gradient(135deg, rgba(16, 185, 129, 0.1), rgba(5, 150, 105, 0.1));
            color: var(--success-color);
            border: 1px solid rgba(16, 185, 129, 0.2);
        }

        .status-pending {
            background: linear-gradient(135deg, rgba(245, 158, 11, 0.1), rgba(217, 119, 6, 0.1));
            color: var(--warning-color);
            border: 1px solid rgba(245, 158, 11, 0.2);
        }

        .status-inactive {
            background: linear-gradient(135deg, rgba(239, 68, 68, 0.1), rgba(220, 38, 38, 0.1));
            color: var(--danger-color);
            border: 1px solid rgba(239, 68, 68, 0.2);
        }

        .nav-footer {
            margin-top: auto;
            padding-top: 1rem;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
        }

        .nav-section {
            margin-bottom: 2rem;
        }

        select {
            background-color: #020617;
            border: 1px solid #ccc;
            padding: 5px;
            border-radius: 5px;
        }

        select option {
            background-color: #0f172a;
            color: rgb(216, 211, 211);
        }

        /* Enhanced Search Styles - Add these to your existing CSS */
.section-search-container {
    position: relative;
    max-width: 50%;
    margin-left: auto;   /* pushes container to the right */
    margin-top: 2rem;
}
.section-header {
    display: flex;
    justify-content: space-between; /* left + right alignment */
    align-items: center;
}

.section-search-input {
    width: 100%;
    padding: 1rem 1rem 1rem 3rem;
    border: 2px solid var(--border-color);
    border-radius: var(--border-radius-sm);
    background: var(--sidebar-bg);
    font-size: 0.875rem;
    color: var(--content-bg);
    transition: var(--transition);
    box-shadow: var(--shadow-sm);
}

.section-search-input:focus {
    outline: none;
    border-color: var(--primary-color);
    box-shadow: 0 0 0 4px rgba(59, 130, 246, 0.1);
    transform: translateY(-1px);
}

.section-search-input::placeholder {
    color: white;
}

.section-search-icon {
    position: absolute;
    left: 1rem;
    top: 50%;
    transform: translateY(-50%);
    color: white;
    font-size: 1.1rem;
    pointer-events: none;
}

.search-clear-btn {
    position: absolute;
    right: 1rem;
    top: 50%;
    transform: translateY(-50%);
    background: none;
    border: none;
    color: var(--text-muted);
    cursor: pointer;
    padding: 0.25rem;
    border-radius: 4px;
    font-size: 1rem;
    transition: var(--transition-fast);
    display: none;
}

.search-clear-btn:hover {
    color: var(--danger-color);
    background: rgba(239, 68, 68, 0.1);
}

.search-results-info {
    padding: 0.75rem 1rem;
    background: linear-gradient(135deg, rgba(59, 130, 246, 0.1), rgba(139, 92, 246, 0.1));
    border-radius: var(--border-radius-sm);
    border-left: 4px solid var(--primary-color);
    font-size: 0.875rem;
    color: var(--primary-color);
    display: none;
}

.no-results {
    text-align: center;
    padding: 3rem 1rem;
    color: var(--text-light);
    font-size: 1rem;
    background: var(--card-bg);
    border-radius: var(--border-radius-sm);
    margin: 1rem 0;
    display: none;
    border: 2px dashed var(--border-color);
}

.no-results i {
    font-size: 3rem;
    margin-bottom: 1rem;
    color: var(--text-muted);
}

/* Table row animations */
.data-table tbody tr {
    transition: all 0.3s ease;
}

.data-table tbody tr.hidden {
    opacity: 0;
    transform: scale(0.95);
    pointer-events: none;
    height: 0;
    padding: 0;
    margin: 0;
    border: none;
}

.data-table tbody tr.hidden td {
    padding: 0;
    border: none;
    height: 0;
    overflow: hidden;
}

/* Search highlight */
.search-highlight {
    background: linear-gradient(120deg, #fef08a 0%, #facc15 100%);
    padding: 0.1rem 0.2rem;
    border-radius: 3px;
    font-weight: 600;
    color: #92400e;
}

/* Loading animation */
.search-loading {
    position: absolute;
    right: 3rem;
    top: 50%;
    transform: translateY(-50%);
    width: 16px;
    height: 16px;
    border: 2px solid var(--border-color);
    border-top: 2px solid var(--primary-color);
    border-radius: 50%;
    animation: searchSpin 1s linear infinite;
    display: none;
}

@keyframes searchSpin {
    0% { transform: translateY(-50%) rotate(0deg); }
    100% { transform: translateY(-50%) rotate(360deg); }
}

/* Dark mode adjustments */
@media (prefers-color-scheme: dark) {
    .section-search-input {
        background: #1e293b;
        color: #f1f5f9;
        border-color: #334155;
    }
    
    .no-results {
        background: #1e293b;
        border-color: #334155;
    }
    
    .search-results-info {
        background: rgba(59, 130, 246, 0.15);
        color: #60a5fa;
    }
}
    </style>
</head>

<body>
    <!-- Sidebar -->
    <div class="sidebar" id="sidebar">
        <div class="sidebar-header">
            <div class="logo-container">
                <div class="logo-icon">
                    <i class="fas fa-graduation-cap"></i>
                </div>
                <div class="logo-text">
                    <h2>Coordinator</h2>
                    <p>Certificate Management</p>
                </div>
            </div>
        </div>

        <nav class="sidebar-nav">

            <div class="nav-section">
                <div class="nav-section-title">Certificates</div>
                <a href="#" class="nav-item" id="nav-offer">
                    <i class="fas fa-file-signature"></i>
                    Offer Letters
                </a>
                <a href="#" class="nav-item" id="nav-completion">
                    <i class="fas fa-award"></i>
                    Completion Certificates
                </a>
                <a href="#" class="nav-item" id="nav-bulk">
                    <i class="fas fa-upload"></i>
                    Bulk Upload
                </a>
                <a href="#" class="nav-item" id="nav-query">
                    <i class="fas fa-question-circle"></i>
                    Student Queries
                </a>

                
            </div>
            <br>
            <br>
            <br>
            <br>
            <div class="nav-footer">
                    <div class="nav-section">
                        <form id="logoutForm" method="POST" action="{% url 'logout' %}">
                            {% csrf_token %}
                            <button type="submit" class="logout-btn">
                                <i class="fas fa-sign-out-alt"></i>
                                Logout
                            </button>
                        </form>
                    </div>
                </div>
        </nav>
    </div>

    <!-- Main Content -->
    <div class="main-content">
        <!-- Top Bar -->
        <div class="top-bar">
            <button class="mobile-menu-btn" id="mobileMenuBtn">
                <i class="fas fa-bars"></i>
            </button>
            <div class="page-title">
                <h1>Welcome back, {{ full_name }}</h1>
                <p>Manage certificates and student records efficiently</p>
            </div>

        </div>

        <div class="dashboard-container">

            <!-- Filter Section -->
            <div class="filter-section">
                 

            </div>

            <!-- Query Section -->
            <div class="certificate-form" id="query-section">
                <div class="form-card">
                    <h3>
                        <i class="fas fa-question-circle"></i>
                        Student Queries
                    </h3>
                    <table class="data-table" id="queriesTable">
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>Student</th>
                                <th>Subject</th>
                                <th>Query</th>
                                <th>Created At</th>
                                <th>Status</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            <!-- Queries will be injected here -->
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Completion Certificate Form -->
            <div class="certificate-form" id="completionForm">
                <div class="form-card">
                    <h3>
                        <i class="fas fa-award"></i>
                        Generate Completion Certificate
                    </h3>
                    <form id="createCompletionForm">
                        <div class="form-row">
                            <div class="form-group">
                                <label for="completionTitle">Title</label>
                                <select id="completionTitle" name="completionTitle" required>
                                    <option value="">Select Title</option>
                                    <option value="Mr">Mr</option>
                                    <option value="Ms">Ms</option>
                                    <option value="Mrs">Mrs</option>
                                    <option value="Dr">Dr</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="completionStudentName">Student Name</label>
                                <input type="text" id="completionStudentName" name="completionStudentName" required>
                            </div>
                            <div class="form-group">
                                <label for="completionRegisterNumber">Register Number</label>
                                <input type="text" id="completionRegisterNumber" name="completionRegisterNumber"
                                    required>
                            </div>
                        </div>

                        <div class="form-row">
                            <div class="form-group">
                                <label for="completionDegree">Degree</label>
                                <select id="completionDegree" name="completionDegree" required
                                    onchange="populateDepartments('completionDegree', 'completionDepartment')">
                                    <option value="">Select Degree</option>
                                    <option value="B.E">Bachelor's of Engineering</option>
                                    <option value="B.Tech">B Tech</option>
                                    <option value="B.Sc">B.Sc (Science)</option>
                                    <option value="B.A">B.A (Arts)</option>
                                    <option value="MBA">MBA</option>
                                    <option value="Diploma">Diploma</option>
                                </select>
                            </div>
                            <div class="form-group" id="completionDepartmentGroup" style="display:none;">
                                <label for="completionDepartment">Department</label>
                                <select id="completionDepartment" name="completionDepartment" required>
                                    <option value="">Select Department</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="completionCollege">College</label>
                                <input type="text" id="completionCollege" name="completionCollege" required>
                            </div>
                        </div>

                        <div class="form-row">
                            <div class="form-group">
                                <label for="completionLocation">Location</label>
                                <input type="text" id="completionLocation" name="completionLocation">
                            </div>
                            <div class="form-group">
                                <label for="completionCourseName">Course/Domain</label>
                                <select type="text" id="completionCourseName" name="completionCourseName" required>
                                    <option value="">Select Course</option>
                                    <option value="Python Full Stack Development">Python Full Stack Development</option>
                                    <option value="Generative AI">Generative AI</option>
                                    <option value="Java Full Stack Development">Java Full Stack Development</option>
                                    <option value="Frontend Development">Frontend Development</option>
                                    <option value="Backend Development">Backend Development</option>
                                    <option value="UI/UX">UI/UX</option>
                                </select>
                            </div>
                            
                        </div>

                        <div class="form-row">
                            <div class="form-group">
                                <label for="completionProject">Project Name</label>
                                <input type="text" id="completionProject" name="completionProject"
                                    placeholder="e.g., Online Portfolio System">
                            </div>
                                                        
                        </div>

                        
                        <div class="form-row">
                            <div class="form-group">
                                <label for="completionStartDate">Start Date</label>
                                <input type="date" id="completionStartDate" name="completionStartDate" required>
                            </div>
                            <div class="form-group">
                                <label for="completionEndDate">End Date</label>
                                <input type="date" id="completionEndDate" name="completionEndDate" required>
                            </div>
                            <div class="form-group">
                                <label for="completionDuration">Duration</label>
                                <input type="text" id="completionDuration" name="completionDuration"
                                    placeholder="e.g., 2 weeks">
                            </div>
                        </div>
                        

                        <div class="form-row">
                            <div class="form-group">
                                <label for="completionDirector">Director Name</label>
                                <select id="completionDirector" name="completionDirector" required>
                                    <option value="">Select Director</option>
                                    <option value="Mr. Surendiran S">Mr. Surendiran S</option>
                                    <option value="Mr. Vasanth Nagarajan ">Mr. Vasanth Nagarajan</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="completionIssueDate">Date of Issue</label>
                                <input type="date" id="completionIssueDate" name="completionIssueDate" required>
                            </div>
                        </div>

                        <div class="form-actions">
                            <button type="submit" class="btn-primary">
                                <i class="fas fa-save"></i>
                                Generate Certificate
                            </button>
                        </div>
                    </form>
                </div>
            </div>

            <!-- Offer Letter Form -->
            <div class="certificate-form" id="offerForm">
                <div class="form-card">
                    <h3>
                        <i class="fas fa-file-signature"></i>
                        Generate Offer Letter
                    </h3>
                    <form id="createOfferForm" enctype="multipart/form-data">
                        <div class="form-row">
                            <div class="form-group">
                                <label for="offerTitle">Title</label>
                                <select id="offerTitle" name="offerTitle" required>
                                    <option value="">Select Title</option>
                                    <option value="Mr">Mr</option>
                                    <option value="Ms">Ms</option>
                                    <option value="Mrs">Mrs</option>
                                    <option value="Dr">Dr</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="offerStudentName">Student Name</label>
                                <input type="text" id="offerStudentName" name="offerStudentName" required>
                            </div>
                            <div class="form-group">
                                <label for="offerRegisterNumber">Register Number</label>
                                <input type="text" id="offerRegisterNumber" name="offerRegisterNumber" required>
                            </div>
                        </div>

                        <div class="form-row">
                            <div class="form-group">
                                <label for="offerDegree">Degree</label>
                                <select id="offerDegree" name="offerDegree" required
                                    onchange="populateDepartments('offerDegree', 'offerDepartment')">
                                    <option value="">Select Degree</option>
                                    <option value="B.E">Bachelor's of Engineering</option>
                                    <option value="B.Tech">B Tech</option>
                                    <option value="B.Sc">B.Sc (Science)</option>
                                    <option value="B.A">B.A (Arts)</option>
                                    <option value="MBA">MBA</option>
                                    <option value="Diploma">Diploma</option>
                                </select>
                            </div>
                            <div class="form-group" id="offerDepartmentGroup" style="display:none;">
                                <label for="offerDepartment">Department</label>
                                <select id="offerDepartment" name="offerDepartment" required>
                                    <option value="">Select Department</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="offerCollege">College</label>
                                <input type="text" id="offerCollege" name="offerCollege" required>
                            </div>
                        </div>

                        <div class="form-row">
                            <div class="form-group">
                                <label for="offerLocation">Location</label>
                                <input type="text" id="offerLocation" name="offerLocation">
                            </div>
                            <div class="form-group">
                                <label for="offerCourseName">Domain</label>
                                <select type="text" id="offerCourseName" name="offerCourseName"
                                required>
                                    <option value="">Select Course</option>
                                    <option value="Python Full Stack Development">Python Full Stack
                                        Development</option>
                                    <option value="Generative AI">Generative AI</option>
                                    <option value="Java Full Stack Development">Java Full Stack
                                        Development</option>
                                    <option value="Frontend Development">Frontend Development
                                    </option>
                                    <option value="Backend Development">Backend Development</option>
                                    <option value="UI/UX">UI/UX</option>
                            </select>
                            </div>
                        </div>

                        <div class="form-row">
                            <div class="form-group">
                                <label for="offerStartDate">Start Date</label>
                                <input type="date" id="offerStartDate" name="offerStartDate" required>
                            </div>
                            <div class="form-group">
                                <label for="offerEndDate">End Date</label>
                                <input type="date" id="offerEndDate" name="offerEndDate" required>
                            </div>
                            <div class="form-group">
                                <label for="offerDuration">Duration</label>
                                <input type="text" id="offerDuration" name="offerDuration" placeholder="e.g., 6 months">
                            </div>
                        </div>

                        <div class="form-row">
                            <div class="form-group">
                                <label for="offerDirector">Director Name</label>
                                <select id="offerDirector" name="offerDirector" required>
                                    <option value="">Select Director</option>
                                    <option value="Mr. Surendiran S">Mr. Surendiran S</option>
                                    <option value="Mr. Vasanth Nagarajan ">Mr. Vasanth Nagarajan</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="offerIssueDate">Date of Issue</label>
                                <input type="date" id="offerIssueDate" name="offerIssueDate" required>
                            </div>
                        </div>

                        <div class="form-actions">
                            <button type="submit" class="btn-primary">
                                <i class="fas fa-save"></i>
                                Generate Certificate
                            </button>
                        </div>
                    </form>
                </div>
            </div>

            <!-- Student Form -->
            <div class="certificate-form" id="addstudentForm">
                <div class="form-card">
                    <h3>
                        <i class="fas fa-user-plus"></i>
                        Add New Student
                    </h3>
                    <form id="addStudentForm">
                        <div class="form-row">
                            <div class="form-group">
                                <label for="newStudentName">Full Name</label>
                                <input type="text" id="newStudentName" name="student_name" required>
                            </div>
                            <div class="form-group">
                                <label for="newStudentEmail">Email</label>
                                <input type="email" id="newStudentEmail" name="student_email" required>
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="newStudentID">Register Number</label>
                                <input type="text" id="newStudentID" name="student_id" required>
                            </div>
                            <div class="form-group">
                                <label for="newDepartment">Department</label>
                                <input type="text" id="newDepartment" name="student_department" required>
                            </div>
                        </div>
                        <div class="form-actions">
                            <button type="submit" class="btn-primary">
                                <i class="fas fa-save"></i>
                                Add Student
                            </button>
                        </div>
                    </form>
                </div>
            </div>

            <!-- Bulk Upload Form -->
            <div class="certificate-form" id="bulkUploadForm">
                <div class="form-card">
                    <h3>
                        <i class="fas fa-upload"></i>
                        Bulk Upload Certificates
                    </h3>
                    <div class="form-row">
                        <div class="form-group">
                            <form id="bulkOfferUploadForm" enctype="multipart/form-data">
                                <label>Upload Offer Letters</label>
                                <input type="file" name="csvFile" accept=".csv, .xls, .xlsx" required
                                    style="margin-bottom: 1rem;">
                                <button type="submit" class="btn-primary">
                                    <i class="fas fa-file-signature"></i>
                                    Upload Offer Letters
                                </button>
                            </form>
                        </div>
                        <div class="form-group">
                            <form id="bulkCompletionUploadForm" enctype="multipart/form-data">
                                <label>Upload Completion Certificates</label>
                                <input type="file" name="csvFile" accept=".csv, .xls, .xlsx" required
                                    style="margin-bottom: 1rem;">
                                <button type="submit" class="btn-primary">
                                    <i class="fas fa-award"></i>
                                    Upload Completion Certificates
                                </button>
                            </form>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Certificates Table -->
            <div class="data-section">
                <!-- Search Bar -->
            <div class="section-search-container">
                <i class="fas fa-search section-search-icon"></i>
                <input 
                    type="text" 
                    class="section-search-input" 
                    id="internshipSearch"
                    placeholder="Search by Student Name, ID, or Course Name..."
                    data-target="internshipTable"
                >
                <div class="search-loading" id="internshipSearchLoading"></div>
                <button class="search-clear-btn" id="internshipSearchClear">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <div class="search-results-info" id="internshipResultsInfo"></div>
            <div class="no-results" id="internshipNoResults">
                <i class="fas fa-search"></i>
                <h4>No results found</h4>
                
            </div>
                <div class="section-header">
                    
                    <h2 class="section-title">
                        <i class="fas fa-certificate"></i>
                        Students Certificates
                    </h2>
                </div>
                
                <table class="data-table" id="internshipTable">
                    <thead>
                        <tr>
                            <th>STUDENT</th>
                            <th>COURSE</th>
                            <th>DATE</th>
                            <th>CERTIFICATE ID</th>
                            <th>TYPE</th>
                            <th>ACTIONS</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% if certificates %}
                        {% for cert in certificates %}
                        <tr 
    data-student_name="{{ cert.student_name }}" 
    data-student_id="{{ cert.student_id }}" 
    data-course_name="{{ cert.course_name }}"
>
                            <td>{{ cert.student_name }}</td>
                            <td>{{ cert.course_name }}</td>
                            <td>{{ cert.completion_date|date:"Y-m-d" }}</td>
                            <td>{{ cert.certificate_number }}</td>
                            <td>{{ cert.get_certificate_type_display }}</td>
                            <td>
                                {% if cert.generated_pdf %}
                                <a href="{{ cert.generated_pdf.url }}" class="download-btn" download>
                                    <i class="fas fa-download"></i>
                                    Download
                                </a>
                                {% else %}
                                <span class="download-btn disabled">N/A</span>
                                {% endif %}
                            </td>
                        </tr>
                        {% endfor %}
                        {% else %}
                        <tr>
                            <td colspan="6" class="empty-state">
                                <i class="fas fa-certificate"></i>
                                <br>
                                No certificates created yet
                            </td>
                        </tr>
                        {% endif %}
                    </tbody>
                </table>

                <!-- Pagination -->
                {% if page_obj.has_other_pages %}
                {% with query_params=request.GET.urlencode %}
                <div class="pagination">
                    {% if page_obj.has_previous %}
                    <a
                        href="?{% if query_params %}{{ query_params }}&{% endif %}page={{ page_obj.previous_page_number }}">
                        <i class="fas fa-angle-left"></i> Previous
                    </a>
                    {% endif %}

                    <span class="current">
                        Page {{ page_obj.number }} of {{ page_obj.paginator.num_pages }}
                    </span>

                    {% if page_obj.has_next %}
                    <a href="?{% if query_params %}{{ query_params }}&{% endif %}page={{ page_obj.next_page_number }}">
                        Next <i class="fas fa-angle-right"></i>
                    </a>
                    {% endif %}
                </div>
                {% endwith %}
                {% endif %}
            </div>
        </div>


    </div>

    <!-- Popup Notification -->
    <div id="popupNotification"></div>

    <script>

        // Enhanced Search Functionality
        class DynamicSearch {
            constructor(searchInputId, targetTableId, searchFields) {
                this.searchInput = document.getElementById(searchInputId);
                this.targetTable = document.getElementById(targetTableId);
                this.searchFields = searchFields;
                this.clearBtn = document.getElementById(searchInputId.replace('Search', 'SearchClear'));
                this.loadingIndicator = document.getElementById(searchInputId.replace('Search', 'SearchLoading'));
                this.resultsInfo = document.getElementById(searchInputId.replace('Search', 'ResultsInfo'));
                this.noResults = document.getElementById(searchInputId.replace('Search', 'NoResults'));
                this.searchTimeout = null;
                
                this.init();
            }

            init() {
                // Real-time search with debouncing
                this.searchInput.addEventListener('input', (e) => {
                    clearTimeout(this.searchTimeout);
                    const searchTerm = e.target.value.trim();
                    
                    // Show/hide clear button
                    this.clearBtn.style.display = searchTerm ? 'block' : 'none';
                    
                    // Show loading indicator
                    if (searchTerm) {
                        this.loadingIndicator.style.display = 'block';
                    }
                    
                    // Debounce search for better performance
                    this.searchTimeout = setTimeout(() => {
                        this.performSearch(searchTerm);
                        this.loadingIndicator.style.display = 'none';
                    }, 300);
                });

                // Clear search functionality
                this.clearBtn.addEventListener('click', () => {
                    this.searchInput.value = '';
                    this.clearBtn.style.display = 'none';
                    this.performSearch('');
                    this.searchInput.focus();
                });

                // Enter key handling
                this.searchInput.addEventListener('keydown', (e) => {
                    if (e.key === 'Enter') {
                        e.preventDefault();
                        clearTimeout(this.searchTimeout);
                        this.performSearch(this.searchInput.value.trim());
                        this.loadingIndicator.style.display = 'none';
                    }
                });
            }

            performSearch(searchTerm) {
    const tbody = this.targetTable.getElementsByTagName('tbody')[0];
    const rows = Array.from(tbody.getElementsByTagName('tr'));

    let visibleRows = [];
    let hiddenRows = [];

    // Clear previous highlights
    this.clearHighlights();

    for (let row of rows) {
        let isMatch = false;

        if (!searchTerm) {
            // Show all rows when search is empty
            isMatch = true;
        } else {
            // Search in specified fields
            for (let field of this.searchFields) {
                const fieldValue = row.getAttribute(`data-${field}`) || '';
                if (fieldValue.toLowerCase().includes(searchTerm.toLowerCase())) {
                    isMatch = true;
                    // Highlight matching text in visible cells
                    this.highlightText(row, searchTerm, field);
                    break;
                }
            }
        }

        if (isMatch) {
            row.classList.remove('hidden');
            visibleRows.push(row);
        } else {
            row.classList.add('hidden');
            hiddenRows.push(row);
        }
    }

    //  Reorder: move matched rows to top, keep hidden at bottom
    tbody.innerHTML = "";
    visibleRows.forEach(r => tbody.appendChild(r));
    hiddenRows.forEach(r => tbody.appendChild(r));

    // Update search results info
    this.updateSearchInfo(searchTerm, visibleRows.length, rows.length);
}


            highlightText(row, searchTerm, field) {
                const cells = row.getElementsByTagName('td');
                const fieldIndex = this.getFieldIndex(field);
                
                if (fieldIndex >= 0 && fieldIndex < cells.length) {
                    const cell = cells[fieldIndex];
                    const originalText = cell.textContent;
                    const regex = new RegExp(`(${this.escapeRegex(searchTerm)})`, 'gi');
                    const highlightedText = originalText.replace(regex, '<span class="search-highlight">$1</span>');
                    cell.innerHTML = highlightedText;
                }
            }

            clearHighlights() {
                const highlights = this.targetTable.querySelectorAll('.search-highlight');
                highlights.forEach(highlight => {
                    const parent = highlight.parentNode;
                    parent.textContent = parent.textContent; // This removes HTML and keeps text
                });
            }

            getFieldIndex(field) {
                // Map data attributes to column indices
                const fieldMap = {
                    'student_name': 0,
                    'student_id': 1,
                    'course_name': 2,
                    'college': 3
                };
                return fieldMap[field] !== undefined ? fieldMap[field] : -1;
            }

            escapeRegex(string) {
                return string.replace(/[.*+?^${}()|[\]\\]/g, '\\$&');
            }

            updateSearchInfo(searchTerm, visibleCount, totalCount) {
                if (!searchTerm) {
                    this.resultsInfo.style.display = 'none';
                    this.noResults.style.display = 'none';
                } else if (visibleCount === 0) {
                    this.resultsInfo.style.display = 'none';
                    this.noResults.style.display = 'block';
                } else {
                    this.resultsInfo.style.display = 'block';
                    this.noResults.style.display = 'none';
                    this.resultsInfo.innerHTML = `
                        <i class="fas fa-info-circle"></i>
                        Found ${visibleCount} result${visibleCount !== 1 ? 's' : ''} 
                        ${visibleCount < totalCount ? `out of ${totalCount}` : ''} 
                        for "${searchTerm}"
                    `;
                }
            }
        }

        // Initialize search for all three sections
        document.addEventListener('DOMContentLoaded', function() {
            // Internship Certificates Search
            new DynamicSearch(
                'internshipSearch', 
                'internshipTable', 
                ['student_name', 'student_id', 'course_name']
            );

            // Add some interactive feedback
            document.querySelectorAll('.section-search-input').forEach(input => {
                input.addEventListener('focus', function() {
                    this.parentNode.style.transform = 'scale(1.02)';
                });
                
                input.addEventListener('blur', function() {
                    this.parentNode.style.transform = 'scale(1)';
                });
            });
        });

        
        document.addEventListener("DOMContentLoaded", function () {
            const tableBody = document.querySelector("#queriesTable tbody");

            function getCookie(name) {
                let cookieValue = null;
                if (document.cookie && document.cookie !== "") {
                    const cookies = document.cookie.split(";");
                    for (let cookie of cookies) {
                        cookie = cookie.trim();
                        if (cookie.startsWith(name + "=")) {
                            cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                            break;
                        }
                    }
                }
                return cookieValue;
            }
            const csrftoken = getCookie("csrftoken");

            //  Format date like "Aug. 30, 2025"
            function formatDate(isoString) {
                const date = new Date(isoString);
                return new Intl.DateTimeFormat("en-US", {
                    month: "short", day: "2-digit", year: "numeric"
                }).format(date);
            }

            function fetchQueries() {
                fetch("/accounts/queries/list/")
                    .then(res => res.json())
                    .then(data => {
                        tableBody.innerHTML = "";
                        data.queries.forEach(q => {
                            const row = document.createElement("tr");
                            row.innerHTML = `
                        <td>${q.id}</td>
                        <td>${q.student}</td>
                        <td>${q.subject}</td>
                        <td>${q.query_text}</td>
                        <td>${formatDate(q.created_at)}</td>
                        <td>
                            <span class="status-badge status-active ${q.resolved ? "status-resolved" : "status-pending"}">
                              ${q.resolved ? "Completed" : "Pending"}
                            </span>
                        </td>
                        <td>
                            ${q.resolved ? "" : `<button class="btn btn-success btn-sm" onclick="resolveQuery(${q.id})"><i class="fas fa-check"></i></button>`}
                            <button class="btn btn-danger btn-sm" onclick="deleteQuery(${q.id})"><i class="fas fa-trash"></i></button>
                        </td>
                    `;
                            tableBody.appendChild(row);
                        });
                    })
                    .catch(err => console.error("Error fetching queries:", err));
            }

            window.resolveQuery = function (id) {
                fetch(`/accounts/queries/resolve/${id}/`, {
                    method: "POST",
                    headers: { "X-CSRFToken": csrftoken }
                })
                    .then(res => res.json())
                    .then(data => {
                        showPopup(data.message);
                        fetchQueries(); //  Refresh table so status changes
                    });
            };

            window.deleteQuery = function (id) {
                fetch(`/accounts/queries/delete/${id}/`, {
                    method: "POST",
                    headers: { "X-CSRFToken": csrftoken }
                })
                    .then(res => res.json())
                    .then(data => {
                        showPopup(data.message);
                        fetchQueries();
                    });
            };

            // Initial load
            fetchQueries();
        });


        // Force reload if user navigates back to this page after logout
        window.history.pushState(null, "", window.location.href);
        window.onpopstate = function () {
            window.history.pushState(null, "", window.location.href);
            location.replace("{% url 'index' %}");
        };

        // Keep session alive
        setInterval(() => {
            fetch('/accounts/ping/');
        }, 5 * 60 * 1000);

        // Department data
        const departmentData = {
            "B.E": [
                "Computer Science and Engineering", "AI & DS",
                "Mechanical Engineering",
                "Electrical Engineering",
                "Civil Engineering",
                "Electronics and Communication Engineering",
                "Mechatronics",
                "Automobile Engineering",
                "Aeronautical Engineering"
            ],
            "B.Tech": [
                "Information Technology",
                "AI & DS",
                "Biotechnology",
                "Petroleum Engineering",
                "Cyber Security",
                "Data Science",
                "Artificial Intelligence and Machine Learning"
            ],
            "B.Sc": [
                "Computer Science",
                "Mathematics",
                "Physics",
                "Chemistry",
                "Information Technology"
            ],
            "B.A": [
                "English Literature",
                "History",
                "Economics",
                "Sociology",
                "Political Science",
                "Tamil Literature"
            ],
            "MBA": [
                "Finance",
                "Marketing",
                "Human Resource Management",
                "Operations Management",
                "International Business"
            ],
            "Diploma": [
                "Computer Engineering",
                "Mechanical Engineering",
                "Civil Engineering",
                "Electrical and Electronics Engineering",
                "Electronics and Communication Engineering"
            ]
        };

        function populateDepartments(degreeId, departmentId) {
            const degree = document.getElementById(degreeId).value;
            const department = document.getElementById(departmentId);
            const departmentGroup = document.getElementById(departmentId + 'Group');
            department.innerHTML = '<option value="">Select Department</option>';

            if (departmentData[degree]) {
                departmentData[degree].forEach(opt => {
                    const option = document.createElement("option");
                    option.value = opt;
                    option.textContent = opt;
                    department.appendChild(option);
                });
                departmentGroup.style.display = "block";
                department.required = true;
            } else {
                departmentGroup.style.display = "none";
                department.required = false;
            }
        }

        function showPopup(message, success = true) {
            let popup = document.getElementById('popupNotification');
            popup.style.backgroundColor = success ? 'var(--success-color)' : 'var(--danger-color)';
            popup.textContent = message;
            popup.style.display = 'block';
            setTimeout(() => { popup.style.display = 'none'; }, 3000);
        }

        function getCookie(name) {
            let cookieValue = null;
            if (document.cookie && document.cookie !== '') {
                const cookies = document.cookie.split(';');
                for (let i = 0; i < cookies.length; i++) {
                    const cookie = cookies[i].trim();
                    if (cookie.substring(0, name.length + 1) === (name + '=')) {
                        cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                        break;
                    }
                }
            }
            return cookieValue;
        }

        document.addEventListener('DOMContentLoaded', function () {
            // Mobile menu toggle
            const mobileMenuBtn = document.getElementById('mobileMenuBtn');
            const sidebar = document.getElementById('sidebar');

            mobileMenuBtn?.addEventListener('click', () => {
                sidebar.classList.toggle('open');
            });

            // Form elements
            const showOfferForm = document.getElementById('showOfferForm');
            const showCompletionForm = document.getElementById('showCompletionForm');
            const showBulkUploadForm = document.getElementById('showBulkUploadForm');
            const showQueryForm = document.getElementById('showQueryForm');
            const offerForm = document.getElementById('offerForm');
            const completionForm = document.getElementById('completionForm');
            const bulkUploadForm = document.getElementById('bulkUploadForm');
            const queryForm = document.getElementById('query-section');
            const tableBody = document.querySelector('.data-table tbody');

            // Navigation items
            const navOffer = document.getElementById('nav-offer');
            const navCompletion = document.getElementById('nav-completion');
            const navBulk = document.getElementById('nav-bulk');
            const navQuery = document.getElementById('nav-query');

            function hideAllForms() {
                offerForm.style.display = 'none';
                completionForm.style.display = 'none';
                bulkUploadForm.style.display = 'none';
                queryForm.style.display = 'none';

                // Update nav states
                document.querySelectorAll('.nav-item').forEach(item => {
                    item.classList.remove('active');
                });
            }

            function setActiveNav(activeItem) {
                document.querySelectorAll('.nav-item').forEach(item => {
                    item.classList.remove('active');
                });
                activeItem.classList.add('active');
            }

            hideAllForms();

            showOfferForm?.addEventListener('click', () => {
                hideAllForms();
                offerForm.style.display = 'block';
                setActiveNav(navOffer);
            });

            navOffer?.addEventListener('click', (e) => {
                e.preventDefault();
                hideAllForms();
                offerForm.style.display = 'block';
                setActiveNav(navOffer);
            });

            showCompletionForm?.addEventListener('click', () => {
                hideAllForms();
                completionForm.style.display = 'block';
                setActiveNav(navCompletion);
            });

            navCompletion?.addEventListener('click', (e) => {
                e.preventDefault();
                hideAllForms();
                completionForm.style.display = 'block';
                setActiveNav(navCompletion);
            });

            showBulkUploadForm?.addEventListener('click', () => {
                hideAllForms();
                bulkUploadForm.style.display = 'block';
                setActiveNav(navBulk);
            });

            navBulk?.addEventListener('click', (e) => {
                e.preventDefault();
                hideAllForms();
                bulkUploadForm.style.display = 'block';
                setActiveNav(navBulk);
            });

            showQueryForm?.addEventListener('click', () => {
                hideAllForms();
                queryForm.style.display = 'block';
                setActiveNav(navQuery);
            });

            navQuery?.addEventListener('click', (e) => {
                e.preventDefault();
                hideAllForms();
                queryForm.style.display = 'block';
                setActiveNav(navQuery);
            });

            function addCertificateToTable(student, course, date, certId, type, downloadUrl) {
                const emptyRow = document.querySelector('.empty-state');
                if (emptyRow) emptyRow.closest('tr').remove();
                const row = document.createElement('tr');
                row.innerHTML = `
                <td>${student}</td>
                <td>${course}</td>
                <td>${date}</td>
                <td>${certId}</td>
                <td>${type}</td>
                <td>
                    ${downloadUrl ? `<a href="${downloadUrl}" class="download-btn" download><i class="fas fa-download"></i> Download</a>` : '<span class="download-btn disabled">N/A</span>'}
                </td>`;
                tableBody.appendChild(row);
            }

            function handleCertificateSubmit(formId, url, type) {
                const form = document.getElementById(formId);
                form?.addEventListener('submit', function (e) {
                    e.preventDefault();
                    const formData = new FormData(form);

                    // Validation
                    const alphaRegex = /^[A-Za-z\s]+$/;
                    const domainRegex = /^[A-Za-z0-9\s.,-]+$/;

                    const nameInput = form.querySelector('[name$="StudentName"], [name="student_name"]');
                    if (nameInput) {
                        const value = nameInput.value.trim();
                        if (!alphaRegex.test(value)) {
                            showPopup('Only letters and spaces allowed in student name.', false);
                            return;
                        }
                    }

                    const locationInput = form.querySelector('[name$="Location"]');
                    if (locationInput) {
                        const value = locationInput.value.trim();
                        if (value && !alphaRegex.test(value)) {
                            showPopup('Only letters and spaces allowed in location field.', false);
                            return;
                        }
                    }

                    const domainInput = form.querySelector('[name$="CourseName"]');
                    if (domainInput) {
                        const value = domainInput.value.trim();
                        if (!domainRegex.test(value)) {
                            showPopup('Only letters, numbers, spaces, and basic punctuation allowed in domain.', false);
                            return;
                        }
                    }

                    const departmentInput = form.querySelector('[name="student_department"]');
                    if (departmentInput) {
                        const value = departmentInput.value.trim();
                        if (!alphaRegex.test(value)) {
                            showPopup('Only letters and spaces allowed in department field.', false);
                            return;
                        }
                    }

                    fetch(url, {
                        method: 'POST',
                        headers: {
                            'X-CSRFToken': getCookie('csrftoken')
                        },
                        body: formData
                    })
                        .then(response => {
                            if (!response.ok) throw new Error('Server error. Please check the form.');
                            return response.json();
                        })
                        .then(data => {
                            if (data.status === 'success') {
                                addCertificateToTable(
                                    data.student,
                                    data.course,
                                    data.date,
                                    data.certificate_number || 'CERT-' + Math.floor(100000 + Math.random() * 900000),
                                    type,
                                    data.download_url || ''
                                );
                                showPopup(data.message, true);
                                form.reset();
                                hideAllForms();
                                document.querySelector('[href="#"]').classList.add('active');

                                setTimeout(() => {
                                    window.location.reload();
                                }, 1500);
                            } else {
                                showPopup(data.message || 'Failed to generate certificate.', false);
                            }
                        })
                        .catch(err => {
                            showPopup(err.message, false);
                        });
                });
            }

            // Bulk upload handlers
            document.getElementById('bulkOfferUploadForm')?.addEventListener('submit', function (e) {
                e.preventDefault();
                const formData = new FormData(this);
                fetch('/accounts/certificate/offer/bulk-upload/', {
                    method: 'POST',
                    headers: {
                        'X-CSRFToken': getCookie('csrftoken')
                    },
                    body: formData
                })
                    .then(res => res.json())
                    .then(data => {
                        if (data.status === 'success') {
                            showPopup(`Successfully generated ${data.created.length} offer certificates.`, true);
                            this.reset();
                            hideAllForms();
                            document.querySelector('[href="#"]').classList.add('active');
                            setTimeout(() => {
                                window.location.reload();
                            }, 1500);
                        } else {
                            showPopup(data.message || 'Bulk upload failed.', false);
                        }
                    })
                    .catch(() => showPopup('Something went wrong!', false));
            });

            document.getElementById('bulkCompletionUploadForm')?.addEventListener('submit', function (e) {
                e.preventDefault();
                const formData = new FormData(this);
                fetch('/accounts/certificate/completion/bulk-upload/', {
                    method: 'POST',
                    headers: {
                        'X-CSRFToken': getCookie('csrftoken')
                    },
                    body: formData
                })
                    .then(res => res.json())
                    .then(data => {
                        if (data.status === 'success') {
                            showPopup(`Successfully generated ${data.created.length} completion certificates.`, true);
                            this.reset();
                            hideAllForms();
                            document.querySelector('[href="#"]').classList.add('active');
                            setTimeout(() => {
                                window.location.reload();
                            }, 1500);
                        } else {
                            showPopup(data.message || 'Bulk upload failed.', false);
                        }
                    })
                    .catch(() => showPopup('Something went wrong!', false));
            });

            // Initialize form handlers
            handleCertificateSubmit('createOfferForm', '/accounts/certificate/offer/create/', 'Offer Letter');
            handleCertificateSubmit('createCompletionForm', '/accounts/certificate/completion/create/', 'Completion Certificate');
            handleCertificateSubmit('addStudentForm', '/accounts/student/add/', 'Student');
        });
    </script>
</body>

</html>